# Faster - r - cnn

# 논문  
[Faster R-CNN: Towards Real-Time Object Detection with Region Proposal Networks](https://proceedings.neurips.cc/paper/2015/file/14bfa6bb14875e45bba028a21ed38046-Paper.pdf)

## 요약
 이 논문에서 특징은 RPN을 도입한 것이 핵심이라고 설명하고 있습니다.
 - 최첨단 물체 감지 네트워크는 물체 위치를 가정하기 위한 지역 제안 알고리즘에 의존한다.
 - RPN은 각 위치에서 객체 경계와 객체 점수를 동시에 예측하는 완전 컨볼루션 네트워크이다
 - 간단한 교대 최적화를 통해 RPN과 Fast R-CNN은 컨볼루션 기능을 공유하도록 훈련될 수 있다
 
 
### 번역 불변 앵커
 우리의 제안 계층은 상당히 적은 수의 매개 변수(GoogLeNet[20]를 사용하는 MultiBox의 경우 2700만 대 VGG-16을 사용하는 RPN의 경우 240만 대)를 가지므로 PASCAL VOC와 같은 소규모 데이터셋의 과적합 위험이 적다.
 
 학습지역 제안을 위한 손실기능
훈련 RPN을 위해, 우리는 각 앵커에 (개체인지 아닌지의) 이진 클래스 레이블을 할당한다. 우리는 (i) 가장 높은 교차-오버-유니온(IoU)을 가진 앵커/앵커 또는 (ii) 모든 지면 진실 박스와 0.7보다 높은 IoU 오버랩을 가진 앵커의 두 가지 앵커에 양성 라벨을 할당한다. 지면 진실 상자 하나가 여러 앵커에 양의 레이블을 할당할 수 있습니다. IoU 비율이 모든 실측 자료 상자에 대해 0.3보다 낮은 경우 비양성 앵커에 음의 레이블을 할당한다. 긍정적이거나 부정적이지 않은 앵커는 훈련 목표에 기여하지 않는다.

여기서, i는 미니 배치에 있는 앵커의 지수이고 pi는 앵커 i가 물체가 될 것으로 예측되는 확률이다. 지반-진실 라벨 p假i는 앵커가 양이면 1이고, 앵커가 음이면 0이다. ti는 예측 경계 박스의 4개의 매개 변수화된 좌표를 나타내는 벡터이며, t假i는 포지티브 앵커와 관련된 지반-진실 박스의 좌표이다. 분류 손실 Lcls는 두 클래스에 대한 로그 손실입니다(개체 대 개체가 아님). 회귀 손실의 경우, 우리는 Lreg(ti, t²i) = R(ti - t²i)을 사용한다. 여기서 R은 [5]에 정의된 강력한 손실 함수(α L1)이다. pøi Lreg라는 용어는 양성 앵커에 대해서만 회귀 손실이 활성화되고(pøi = 1) 그렇지 않으면 비활성화된다는 것을 의미합니다(pøi 0 0). 클래스 및 규칙 계층의 출력은 각각 {pi} 및 {ti}(으)로 구성됩니다. 두 항은 Ncls 및 Nreg와 균형 가중치 α.3으로 정규화된다.

그럼에도 불구하고, 우리의 방법은 이전의 특징 지도 기반 방법과 다른 방법으로 경계 상자 회귀를 달성한다 [7, 5]. [7, 5]에서 경계 상자 회귀는 임의 크기의 영역에서 풀링된 형상에 대해 수행되며 회귀 가중치는 모든 영역 크기에 의해 공유된다. 공식에서 회귀에 사용되는 형상은 형상 맵에서 동일한 공간 크기(n × n)이다. 다양한 크기를 설명하기 위해 k bounding-box regressors 집합을 학습합니다. 각 회귀 분석기는 하나의 척도 및 하나의 가로 세로 비율을 담당하며, K 회귀 분석기는 가중치를 공유하지 않습니다. 따라서, 형상이 고정된 크기/척도임에도 불구하고 다양한 크기의 상자를 예측할 수 있다.
### 최적화
완전 컨볼루션 네트워크로 자연스럽게 구현되는 RPN[14]은 역전파 및 확률적 경사 하강(SGD)에 의해 종단간 훈련될 수 있다[12]. 우리는 이 네트워크를 훈련시키기 위해 [5]의 "이미지 중심" 샘플링 전략을 따른다. 각 미니 배치에는 많은 양의 앵커와 음의 앵커가 포함된 단일 이미지에서 발생합니다. 모든 앵커의 손실 함수에 대해 최적화할 수 있지만, 이는 앵커가 우세할 때 음의 샘플로 치우치게 됩니다. 대신, 우리는 이미지에서 256개의 앵커를 무작위로 추출하여 미니 배치의 손실 함수를 계산한다. 여기서 샘플링된 양극 및 음극 앵커는 최대 1:1의 비율을 갖는다. 이미지에 양성 검체가 128개 미만일 경우 미니 배치에 음성의 샘플을 패딩합니다.

지역제안 및 객체탐지를 위한 컨볼루션 특성 공유
지금까지 우리는 이러한 제안을 활용할 지역 기반 객체 감지 CNN을 고려하지 않고 지역 제안 생성을 위한 네트워크를 훈련시키는 방법을 설명하였다. 감지 네트워크의 경우 Fast R-CNN [5]4를 채택하고 이제 RPN과 Fast R-CNN 간에 공유되는 컨베이어를 학습하는 알고리즘을 설명한다.

독립적으로 훈련되는 RPN과 Fast R-CNN은 모두 다른 방식으로 그들의 컨베이어를 수정할 것이다. 따라서 우리는 두 개의 별도 네트워크를 학습하기 보다는 두 개의 네트워크 사이에서 컨베이어를 공유할 수 있는 기술을 개발할 필요가 있다. 이는 단순히 RPN과 Fast R-CNN을 모두 포함하는 단일 네트워크를 정의한 다음 역 전파와 함께 최적화하는 것만큼 쉽지 않다. 그 이유는 Fast R-CNN 훈련은 고정된 객체 제안에 의존하며 Fast R-CNN을 학습하면서 동시에 제안 메커니즘을 변경할지 여부가 우선 순위가 명확하지 않기 때문이다. 이 공동 최적화는 향후 작업에 흥미로운 질문이지만, 우리는 교차 최적화를 통해 공유 기능을 학습하는 실용적인 4단계 훈련 알고리즘을 개발한다.

첫 번째 단계에서는 위에서 설명한 대로 RPN을 훈련한다. 이 네트워크는 ImageNet 사전 교육된 모델과 지역 제안 작업에 대해 엔드 투 엔드 미세 조정된 모델로 초기화됩니다. 두 번째 단계에서, 우리는 1단계 RPN에 의해 생성된 제안을 사용하여 Fast R-CNN에 의한 별도의 탐지 네트워크를 훈련시킨다. 또한 이 감지 네트워크는 ImageNet 사전 교육 모델에 의해 초기화됩니다. 이 시점에서 두 네트워크는 컨베이어를 공유하지 않는다. 세 번째 단계에서는 검출기 네트워크를 사용하여 RPN 훈련을 초기화하지만 공유 컨베이어를 수정하고 RPN 고유의 레이어만 미세 조정한다. 이제 두 네트워크는 콘트롤러를 공유합니다. 마지막으로, 공유 컨베이어를 고정하여 Fast R-CNN의 fc 레이어를 미세 조정한다. 따라서 두 네트워크는 동일한 컨베이어를 공유하고 통합 네트워크를 형성한다.
